"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}();!function(e){function t(s){if(a[s])return a[s].exports;var l=a[s]={i:s,l:!1,exports:{}};return e[s].call(l.exports,l,l.exports,t),l.l=!0,l.exports}var a={};t.m=e,t.c=a,t.d=function(e,a,s){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var s=a(1);firebase.initializeApp(s.a);var l=firebase.database(),r=l.ref("/game"),i=l.ref("/game/chat"),c=new(function(){function e(){_classCallCheck(this,e),this.choices=["r","p","s","l","sp"],this.choicesMap={r:"Rock",p:"Paper",s:"Scissors",l:"Lizard",sp:"Spock"},this.results=[["tie","win","lose","win","win"],["lose","tie","win","win","lose"],["win","lose","tie","lose","win"],["win","lose","win","tie","win"],["lost","win","lose","lose","tie"]],this.playerName="",this.currentPlayer=0}return _createClass(e,[{key:"addPlayer",value:function(e){var t=this;r.once("value",function(a){var s=a.child("players").numChildren();0===s?(t.currentPlayer=1,$("#player-one .choices").show()):1===s&&(t.currentPlayer=2,$("#player-two .choices").show()),t.playerName=e,r.child("players/"+t.currentPlayer).update({name:e,wins:0,losses:0})}),r.child("players/"+this.currentPlayer).onDisconnect().remove()}}]),e}()),n=function(e){var t=e.child("players/1").val().choice,a=e.child("players/2").val().choice,s=c.choices.indexOf(t,0),l=c.choices.indexOf(a,0),i=c.results[l][s];r.child("players/1/choice").remove(),r.child("players/2/choice").remove();var n=void 0,o=void 0;if("win"===i?(n=1,o=2):"lose"===i&&(n=2,o=1),"win"===i||"lose"===i){var p=e.child("players/"+n).val().wins+1,h=e.child("players/"+o).val().losses+1;r.child("players/"+n).update({wins:p}),r.child("players/"+o).update({losses:h}),function(e,t,a){r.once("value",function(s){$("#status h2").text(s.child("players/"+e).val().name+" wins!"),$(".choices").hide(),$("#player-one-status").text(""+c.choicesMap[t]),$("#player-two-status").text(""+c.choicesMap[a]),setTimeout(function(){1===c.currentPlayer?$("#player-one .choices").show():2===c.currentPlayer&&$("#player-two .choices").show()},3e3)})}(n,t,a),r.once("value",function(e){$("#player-one-wins").text(e.child("players/1").val().wins),$("#player-two-wins").text(e.child("players/2").val().wins),$("#player-one-losses").text(e.child("players/1").val().losses),$("#player-two-losses").text(e.child("players/2").val().losses)})}else $("#status h2").text("Tie!")};r.on("value",function(e){e.child("turn").exists()||(e.child("players/1").exists()&&function(e){$("#player-one h3").text(e.child("players/1").val().name),$("#player-one .stats").show()}(e),e.child("players/2").exists()&&function(e){$("#player-two h3").text(e.child("players/2").val().name),$("#player-selection").hide(),r.update({turn:1}),$("#player-two .stats").show()}(e)),function(e){2===c.currentPlayer&&e.child("players/1/choice").exists()&&!e.child("players/2/choice").exists()?$("#player-one-status").text("Player one has made their choice!"):1===c.currentPlayer&&!e.child("players/1/choice").exists()&&e.child("players/2/choice").exists()&&$("#player-two-status").text("Player two has made their choice!")}(e),e.child("players/1/choice").exists()&&e.child("players/2/choice").exists()&&(n(e),setTimeout(function(){$("#status h2").text(""),$("#player-one-status").empty(),$("#player-two-status").empty(),$(".choice").each(function(){$(this).removeClass("active")})},3e3),r.update({turn:1}))}),r.child("players").on("child_removed",function(e){var t=e.val().name;$("h3:contains("+t+")").empty(),$("#chat-messages").append('<p class="log">'+t+" left at "+moment().format("h:mm:ss A")+"</p>"),r.child("turn").remove(),1===c.currentPlayer?($("#player-two h3").text("Waiting for player two..."),$("#player-two-wins").empty(),$("#player-two-losses").empty()):($("#player-one h3").text("Waiting for player one..."),$("#player-one-wins").empty(),$("#player-one-losses").empty())}),i.on("child_added",function(e){$("#chat-messages").append('\n    <div class="chat-message">\n      <p class="timestamp">'+moment().format("h:mm:ss A")+'</p>\n      <p class="message"><strong>'+e.val().name+"</strong>: "+e.val().message+"</p>\n    </div>\n  ")}),$("#chat-submit").click(function(e){e.preventDefault();var t=$("#chat-msg").val().trim();t&&(r.child("chat").push({name:c.playerName,message:t}),$("#chat-msg").val(""))}),$(".toggle").click(function(e){e.preventDefault(),$("#chat").toggleClass("active").toggleClass("minimized")}),$("#player-submit").click(function(e){e.preventDefault();var t=$("#name").val().trim();c.addPlayer(t),$("#player-selection").hide(),$("#chat-submit").prop("disabled",!1)}),$(".choice").click(function(e){var t=this;e.preventDefault(),r.once("value",function(e){if(e.child("players/1").exists()&&e.child("players/2").exists()&&(1===c.currentPlayer&&!e.child("players/1/choice").exists()||2===c.currentPlayer&&!e.child("players/2/choice").exists())){var a=$(t).data("choice");$(t).addClass("active"),r.child("players/"+c.currentPlayer).update({choice:a}),r.update({turn:e.val().turn+1})}})})},function(e,t,a){t.a={apiKey:"AIzaSyCZUhkXr_UVjBe7frVSZywUTJMuN_Kvl7Y",authDomain:"rps-multiplayer-f4e29.firebaseapp.com",databaseURL:"https://rps-multiplayer-f4e29.firebaseio.com",projectId:"rps-multiplayer-f4e29",storageBucket:"rps-multiplayer-f4e29.appspot.com",messagingSenderId:"1011998257607"}}]);